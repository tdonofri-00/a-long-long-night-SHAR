Game.SelectMission("m2")

Game.SetMissionResetPlayerInCar("m2_car_loc")
Game.SetDynaLoadData("l5z3.p3d;l5r2.p3d;l5r3.p3d;")
Game.StreetRacePropsLoad("l1m1_baracade.p3d;") -- Barracade
Game.StreetRacePropsUnload("l1m1_baracade.p3d:") -- Barracade

Game.UsePedGroup(5)
Game.SetNumValidFailureHints( 5 )

Game.AddStage()
Game.SetStageMessageIndex(12)
Game.AddObjective("getin")
Game.SetObjTargetVehicle("current")
Game.CloseObjective()
if Mode.IsHard then
Game.SetStageTime(10)
Game.AddCondition("timeout")
Game.CloseCondition()
end
Game.CloseStage()

Game.AddStage()
Game.RESET_TO_HERE()
Game.SetStageMessageIndex(3)
Game.SetHUDIcon("w_hotel")
Game.AddObjective("goto")
Game.SetDestination("m2_hotel","carsphere")
Game.RemoveNPC("npd")
Game.AddStageVehicle("cLimo","m2_limostart","NULL","Missions\\level01\\m3_2ndNORM.con","mobstr")
Game.CloseObjective()
if Mode.IsNormal then
Game.SetStageTime(35)
else
Game.SetStageTime(25)
end
Game.AddCondition("timeout")
Game.CloseCondition()
Game.AddCondition("outofvehicle")
Game.SetCondTime( 10000 )
Game.CloseCondition()
Game.AddCondition( "damage" )
Game.SetCondMinHealth( 0.0 )
Game.SetCondTargetVehicle( "current" )
Game.CloseCondition()
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage()
Game.SetHUDIcon("w_hotel")
Game.SetStageMessageIndex(8)
Game.AddObjective("goto")
Game.AddNPC("npd","m2_npd2")
Game.SetDestination("m2_wedding_1","triggersphere")
Game.MustActionTrigger()
Game.SetCollectibleEffect("none")
Game.CloseObjective()
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage(1) -- THOMAS DIALOG AAAAAAAAAAA
Game.AddObjective("dialogue")
Game.AddNPC("npd","m2_npd2")
Game.AmbientAnimationRandomize( 1, 0 )
Game.AmbientAnimationRandomize( 0, 0 )
Game.SetConversationCam( 0, "npc_near" )
Game.AddAmbientNpcAnimation( "none" )
Game.AddAmbientNpcAnimation( "none" )
Game.AddAmbientNpcAnimation( "none" )
Game.AddAmbientPcAnimation( "none" )
Game.AddAmbientPcAnimation( "dialogue_scratch_head" )
Game.AddAmbientPcAnimation( "none" )
Game.SetDialogueInfo("bart","npd","wedding",0)
Game.CloseObjective()
Game.CloseStage()

Game.AddStage()
-- the reason the glass sound effect is bart dialog is because it's easier lol
-- considering the stage is faded out
-- Basically if I use a FadeOut command it's because what I wanted to create just isn't feasible in MFK scripts
-- even with ASF commands
Game.SetStageMessageIndex(4)
Game.SetHUDIcon("w_limo")
Game.AddObjective("goto")
Game.SetDestination("m2_steal","triggersphere")
Game.RemoveNPC("npd")
Game.MustActionTrigger()
Game.SetCollectibleEffect("none")
Game.SetFadeOut(0.5)
Game.CloseObjective()
Game.SetStageMusicAlwaysOn()
Game.SetCompletionDialog("glass")
Game.CloseStage()

Game.AddStage()
Game.AddStageCharacter("bart", "", "", "current", "m2_racestart")
Game.AddObjective("timer")
Game.SetDurationTime(1)
Game.StayInBlack()
Game.CloseObjective()
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage()
-- Honestly a short race seemed more interesting than a lead to stage
-- Also adding best man as a racer
Game.CHECKPOINT_HERE()
Game.SetCheckpointDynaLoadData("l5r1.p3d;l5z2.p3d;l5r2.p3d;l5r3.p3d;")
Game.SetCheckpointResetPlayerInCar("m2_racestart" )
Game.SetStageMessageIndex(5)
Game.SetHUDIcon("w_park")
Game.DisableHitAndRun()
Game.StartCountdown("count")
Game.AddToCountdownSequence( "3", 800 ) -- duration time in milliseconds
Game.AddToCountdownSequence( "2", 800 ) -- duration time in milliseconds
Game.AddToCountdownSequence( "1", 600 ) -- duration time in milliseconds
Game.AddToCountdownSequence( "GO", 400 ) -- duration time in milliseconds
Game.NoTrafficForStage()
Game.ActivateVehicle("cLimo","NULL","race")
Game.AddStageVehicle("cNerd","m2_nerdrace","race","Missions\\level01\\m3_2ndNORM.con","male2")
Game.AddStageWaypoint( "m2_raceend" )
Game.AddObjective( "race")
Game.AddCollectible("m2_raceendB","carsphere")
Game.SetCollectibleEffect("wrench_collect")
Game.CloseObjective()
Game.AddCondition("position")
Game.SetConditionPosition(1)
Game.CloseCondition()
Game.AddCondition( "damage" )
Game.SetCondMinHealth( 0.0 )
Game.SetCondTargetVehicle( "current")
Game.CloseCondition()
Game.AddCondition("outofvehicle")
Game.SetCondTime( 10000 )
Game.CloseCondition()
Game.AddCondition("race")
Game.SetCondTargetVehicle("cLimo","cNerd")
Game.CloseCondition()
Game.SetFadeOut(0.1)
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage() -- teleports the player from playable stage to camera
Game.SetStageAllowMissionCancel(0)
Game.SetMaxTraffic(0)
Game.AddObjective("timer")
Game.StayInBlack()
Game.SetDurationTime(0.1)
Game.AddStageCharacter("bart", "spawn_player_to_cam_here", "", "current", "m2_car")
Game.CloseObjective()
Game.StageStartMusicEvent("M2_drama")
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage(0) -- AAAAAAAAAAA CINEMATICS
Game.CHECKPOINT_HERE()
Game.SetCheckpointDynaLoadData("l5z1.p3d;l5r1.p3d;l5r4.p3d;")
Game.SetCheckpointResetPlayerOutCar( "spawn_player_to_cam_here", "m2_carstart" )
-- Obligatory checkpoint because players new to this stage have only trial and error to find inside/outside triggers
-- I'd prefer not to make players rage like Donut Mod Hellfish lmao
Game.SetStageAllowMissionCancel(0)
Game.SetMaxTraffic(0)
Game.AddStageCharacter("bart", "spawn_player_to_cam_here", "", "current", "m2_car")
Game.AddStageWaypoint("m2_wp_1")
Game.AddStageWaypoint("m2_wp_2")
Game.AddStageWaypoint("m2_wp_3")
Game.AddStageWaypoint("m2_wp_4")
Game.AddStageWaypoint("m2_wp_5")
Game.AddObjective("timer")
Game.AddStageVehicle("cLimo2","m2_nerdcam","evade","Missions\\level04\\M7Evade.con","mobstr")
Game.AddStageVehicle("cNerd","m2_limocam","evade","Missions\\level04\\M7Evade.con","male2")
Game.SetDurationTime(7.5)
Game.SetFadeOut(0.1)
Game.CloseObjective()
Game.StageStartMusicEvent("M2_drama")
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage() -- teleports the player from camera to playable stage
Game.DisableTrigger("some_camera_locator") -- THIS LINE IS NEEDED FOR EVERY STAGE AFTER "AAAAAAAAAAA CINEMATICS"
Game.SetStageAllowMissionCancel(0)
Game.AddObjective("timer")
Game.SetDurationTime(1)
Game.AddStageCharacter("bart", "m2_bart_escape", "", "current", "m2_car")
Game.CloseObjective()
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage()
Game.DisableTrigger("some_camera_locator")
Game.AddStageCharacter("bart", "m2_bart_escape", "", "current", "m2_carstart")
Game.SetHUDIcon("w_park")
Game.SetStageMessageIndex(6)
Game.SetMaxTraffic(4)
Game.AddObjective("goto")
-- I wonder if theres a better way to distinguish NPCS near the inside/outside triggers
-- Because there is no purpose for them other than immersion at this point kek
Game.AddNPC("male2","m2_crowd_npc1")
Game.AddNPC("olady2","m2_crowd_npc2")
Game.AddNPC("male4","m2_crowd_npc3")
Game.AddNPC("fem3","m2_crowd_npc4")
Game.SetDestination("m2_escape","triggersphere")
Game.SetCollectibleEffect("none")
Game.SetFadeOut(0.1)
if Mode.IsHard then
Game.SetStageTime(30)
Game.AddCondition("timeout")
Game.CloseCondition()
end
-- Still an easy timer since this whole thing is basically trial and error
Game.CloseObjective()
Game.AddCondition("insidetrigger")
Game.SetCondTrigger("m2_crowd1")
Game.SetCondThreshold(3)
Game.SetCondMessageIndex(9)
Game.SetCondDecay(3, 2)
Game.SetCondSound("gag_clnk","enter_trigger")
Game.SetCondSound("countdown_beeps","inside_trigger",1,5)
Game.SetCondSound("d_bcrash_brt_02","exit_trigger")
Game.SetFadeOut(0.1)
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage()
Game.DisableTrigger("some_camera_locator")
Game.SetStageAllowMissionCancel(0)
Game.AddObjective("timer")
Game.SetDurationTime(1)
Game.AddStageCharacter("bart", "m2_bart_free", "", "current", "m2_car")
-- This is just to teleport the current car to the player
-- It really wouldn't make sense that you're sneaking out of the park if your car is right next to ya
-- Immersion in SHAR modding is kinda taboo lmao
Game.StayInBlack()
Game.CloseObjective()
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage()
Game.DisableTrigger("some_camera_locator")
Game.SetStageMessageIndex(12)
Game.AddObjective("getin")
Game.SetObjTargetVehicle("current")
Game.AddStageVehicle("cNerd","m2_bestman","NULL","Missions\\level01\\M2chase.con","male2")
Game.CloseObjective()
if Mode.IsHard then
Game.AddStageTime(10)
Game.AddCondition("timeout")
Game.CloseCondition()
end
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage()
Game.DisableTrigger("some_camera_locator")
Game.ShowStageComplete()
Game.SetHUDIcon( "w_bestmn" )
Game.SetStageMessageIndex(7)
Game.SetStageTime(30)
Game.ActivateVehicle("cNerd","NULL","chase")
Game.AddObjective("losetail")
Game.SetObjTargetVehicle("cNerd")
if Mode.IsNormal then
Game.SetObjDistance(150)
else
Game.SetObjDistance(160)
end
-- unsure if there is a more efficient way to remove the extra npcs
Game.RemoveNPC("male2")
Game.RemoveNPC("male4")
Game.RemoveNPC("olady2")
Game.RemoveNPC("fem3")
Game.CloseObjective()
Game.AddCondition("timeout")
Game.CloseCondition()
Game.AddCondition("outofvehicle")
Game.SetCondTime( 10000 )
Game.CloseCondition()
Game.AddCondition( "damage" )
Game.SetCondMinHealth( 0.0 )
Game.SetCondTargetVehicle( "current" )
Game.CloseCondition()
--Game.StageStartMusicEvent("M2_drama")
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.AddStage("final")
Game.DisableTrigger("some_camera_locator")
Game.SetStageMessageIndex(3)
Game.SetHUDIcon("w_hotel")
Game.AddObjective("goto")
Game.SetDestination("m2_hotel","carsphere")
Game.CloseObjective()
Game.AddCondition("outofvehicle")
Game.SetCondTime( 10000 )
Game.CloseCondition()
Game.AddCondition( "damage" )
Game.SetCondMinHealth( 0.0 )
Game.SetCondTargetVehicle( "current" )
Game.CloseCondition()
Game.StageStartMusicEvent("M2_start")
Game.SetStageMusicAlwaysOn()
Game.CloseStage()

Game.CloseMission()